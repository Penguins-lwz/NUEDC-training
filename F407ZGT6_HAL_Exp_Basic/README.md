# README

* 本工程适配电气学院《微控制器原理及应用实验》课程基础实验部分
* 本工程使用 HAL 库，可用于验收；但为应对理论考试，读者应自行学习 SPL 库

## 使用指南

* 主程序使用变量 workState 区分实验内容，可由按键切换所有基础实验
* 按键按下 100 ~ 400 ms 视为短按，按下 400 ms 以上视为长按
* 除实验要求按键按下时有效外，其余时刻均在松手后生效；除特别说明外，按键均为短按有效
* 上电／复位后，默认处于 workState = 0，按下 KEY1、KEY2 切换该值，按下 KEY0 确定并进入实验
* 在任意实验中，按下 KEY3 退出当前实验，重新进入可用于复位实验参数

## 实验内容

### 实验 1 任务 1 (workState = 1)

* 按下 KEY0 后，蜂鸣器连续鸣响 2 s 自动停止

### 实验 1 任务 2 (workState = 2)

* 红色 LED 以 2 s 为周期闪烁，绿色 LED 以 0.7 s 为周期闪烁

### 实验 1 任务 3 (workState = 3)

* 按下 KEY0 时，蜂鸣器鸣响，绿色 LED 以 0.5 s 为周期闪烁

### 实验 2 (workState = 4)

#### PWM 输出 (PE5)

* 使用 TIM9 发出周期为 2 ms，脉宽可调（默认 500 us）的正方波
* 按键 KEY0 用于循环切换 PWM 脉宽，可选值：15 us、500 us、1500 us

#### PWM 输入 (PB4)

* 使用 TIM3 接收周期不超过 65535 us 的正方波，测量周期与脉宽
* TIM3 采样率（预分频后时钟）为 1 MHz，未作溢出保护

### 实验 3 (workState = 5)

#### ADC 直流采样 (PA7)

* 使用 ADC2_IN7，由 TIM2 以 10 kHz 采样率驱动，由 DMA 转运，分别以 8 位、12 位精度采样
* 两种采样精度均采集 10 个点，分别取平均值并转换为电压值后显示至 LCD
* 按键 KEY0 用于单次采样或暂停连续采样，按键 KEY1 用于开启或暂停连续采样
* 注意：实验用开发板地弹噪声较大，与 GND 短接后测量结果略显波动，属正常现象

#### ADC 交流采样 (PA6)

* 使用 ADC1_IN6，由 TIM2 分别以 1 kHz、10 kHz 采样率驱动，由 DMA 转运，以 12 位精度采样
* 低采样率采集 20 个点，高采样率采集 200 个点，分别取峰峰值并转换为电压值后显示至 LCD
* 按键 KEY0 用于单次采样或暂停连续采样，按键 KEY1 用于开启或暂停连续采样
* 注意：每周期采样点数较少（不足 4 个点）时，测量峰峰值可能严重偏差，属欠采样正常现象

#### DAC 正弦输出 (PA4)

* 使用 DAC_OUT1，由 TIM6 驱动，发出峰峰值 2 V、偏置 1.5 V、频率可调（默认 50 Hz）的正弦波
* 按键 KEY2 用于循环切换 DAC 频率，可选值：50 Hz、100 Hz、500 Hz、1 kHz、5 kHz、10 kHz、50 kHz
* 注意：除 50 kHz 使用每周期 30 个点波形外，其余频率使用每周期 120 个点波形

### 实验 4 (workState = 6)

#### 正常状态

* 使用 USART1 进行不超过 10007 字节（不含 `'\0'`）、波特率可调（默认 115.2 KBps）的串口通信，屏显当前波特率
* 执行串口发送时，绿色 LED 以 0.2 s 为周期闪烁，屏显发送字符串内容与长度（绿色）
* 执行串口接收时，红色 LED 以 0.2 s 为周期闪烁，屏显发送字符串内容与长度（红色）
* 按键 KEY0 用于循环切换波特率，可选值：2.4 KBps、4.8 KBps、9.6 KBps、19.2 KBps、38.4 KBps、57.6 KBps、115.2 KBps、230.4 KBps、460.8 KBps、576.0 KBps、921.6 KBps、1.152 MBps，长按此按键将波特率复位至 115.2 KBps
* 按键 KEY1 用于发送预设字符串，短按发送字符串长度为 100 Byte，长按发送字符串长度为 10000 Byte
* 按键 KEY2 用于清屏，仅清除发送或接收的字符串内容与长度，保留波特率
* 注意：向 MCU 发送、或使 MCU 发送超过最大长度的字符串时，尾部字符串将被忽略
* 注意：仅 ASCII 表中的可见字符可显示至 LCD，非法字符将显示为空格
* 注意：红色 LED 在接收到首个字符后立即响应，屏显在接收空闲或已达最大长度后响应

#### 异常状态

* 向 MCU 发送波特率不匹配的字符串时，串口将被锁定，红色、绿色 LED 长亮，屏显报警
* 长按按键 KEY2 用于串口接收重置，其余按键与短按 KEY2 无效（但 KEY3 退出实验仍具有最高优先级）
* 注意：退出实验后重新进入也可用于串口重置，同时复位波特率至默认值
