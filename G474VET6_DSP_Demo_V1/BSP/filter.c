#include "filter.h"

// 滤波器系数个数
#define FIR_NUM_TAPS			101

// 单次 arm_fir_f32() 处理的采样点数，可取 1 ~ FILTER_SIZE
#define FIR_BLOCK_SIZE			16

float pState[FIR_BLOCK_SIZE + FIR_NUM_TAPS - 1];

// FIR 滤波器系数，由 Matlab 生成
const float pCoeffs[FIR_NUM_TAPS] = {
	-0.001491382835,  -0.0006769960164, -0.000815020001,  -0.0009592013084, -0.001106497366,
	-0.001253384398,  -0.001395951957,  -0.001529123634,  -0.001647867961,  -0.001746278955,
	-0.001818346675,  -0.001857570256,  -0.001857581432,  -0.001811663155,  -0.001713238074,
	-0.001555533963,  -0.001332225278,  -0.001037170063,  -0.0006650703726, -0.0002111058711,
	 0.0003284929844,  0.0009570090915,  0.001676556538,   0.00248849066,    0.003392393934,
	 0.004386770073,   0.005468378309,   0.006633464247,   0.007876603864,   0.009191466495,
	 0.01056913473,    0.01199986693,    0.0134742232,     0.0149812093,     0.0165059045,
	 0.01803681441,    0.01956065185,    0.02106065489,    0.0225252118,     0.02393769287,
	 0.02528497949,    0.0265521165,     0.02772676572,    0.02879545093,    0.02974727936,
	 0.03057108447,    0.03125845268,    0.03180103749,    0.03219331801,    0.0324302204,
	 0.03250968084,    0.0324302204,     0.03219331801,    0.03180103749,    0.03125845268,
	 0.03057108447,    0.02974727936,    0.02879545093,    0.02772676572,    0.0265521165,
	 0.02528497949,    0.02393769287,    0.0225252118,     0.02106065489,    0.01956065185,
	 0.01803681441,    0.0165059045,     0.0149812093,     0.0134742232,     0.01199986693,
	 0.01056913473,    0.009191466495,   0.007876603864,   0.006633464247,   0.005468378309,
	 0.004386770073,   0.003392393934,   0.00248849066,    0.001676556538,   0.0009570090915,
	 0.0003284929844, -0.0002111058711, -0.0006650703726, -0.001037170063,   -0.001332225278,
	-0.001555533963,  -0.001713238074,  -0.001811663155,  -0.001857581432,   -0.001857570256,
	-0.001818346675,  -0.001746278955,  -0.001647867961,  -0.001529123634,   -0.001395951957,
	-0.001253384398,  -0.001106497366,  -0.0009592013084, -0.000815020001,   -0.0006769960164,
	-0.001491382835
};

void myARM_FIR(float *pInputData, float *pOutputData)
{
	arm_fir_instance_f32 S;
	arm_fir_init_f32(&S, FIR_NUM_TAPS, pCoeffs, pState, FIR_BLOCK_SIZE);
	for (uint16_t i = 0; i < FILTER_SIZE / FIR_BLOCK_SIZE; ++i)
		arm_fir_f32(&S, &pInputData[i * FIR_BLOCK_SIZE], &pOutputData[i * FIR_BLOCK_SIZE], FIR_BLOCK_SIZE);
}
