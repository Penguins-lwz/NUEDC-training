#include "fir.h"

// A symmetric coefficient array created by MATLAB
// Lowpass, FIR-Equiripple, Minimum order, Density Factor = 20
// wpass = 0.04, wstop = 0.1, Apass = 1, Astop = 40
const float32_t FIR_Coeffs[FIR_NUM_TAPS] = {
	 -0.01128093122673, -0.009631187302064, -0.004772336382912,  -0.01058390758961,
	-0.006988045034931,  -0.01040633934737, -0.007040492409864, -0.008135515260078,
	-0.004200924330841, -0.003021277060906,   0.00192470411488,  0.005216638562514,
	   0.0112743524601,   0.01626718884266,   0.02315573448135,   0.02919994254134,
	  0.03635757353076,    0.0426031594723,   0.04924819670164,   0.05477320545846,
	  0.06008580113934,   0.06403446970887,   0.06731333154478,    0.0690320628898,
	  0.06984607082486,    0.0690320628898,   0.06731333154478,   0.06403446970887,
	  0.06008580113934,   0.05477320545846,   0.04924819670164,    0.0426031594723,
	  0.03635757353076,   0.02919994254134,   0.02315573448135,   0.01626718884266,
	   0.0112743524601,  0.005216638562514,   0.00192470411488, -0.003021277060906,
	-0.004200924330841, -0.008135515260078, -0.007040492409864,  -0.01040633934737,
	-0.006988045034931,  -0.01058390758961, -0.004772336382912, -0.009631187302064,
	 -0.01128093122673
};

// An internal buffer for calculating
// The larger the buffer size is, the faster the calculation speed is
float32_t FIR_Buffer[FIR_NUM_TAPS + FIR_BLOCK_SIZE - 1];

void FIR_f32(float32_t *pSrc, float32_t *pDst)
{
	arm_fir_instance_f32 S;
	arm_fir_init_f32(&S, FIR_NUM_TAPS, FIR_Coeffs, FIR_Buffer, FIR_BLOCK_SIZE);
	for (uint16_t i = 0; i < FIR_DATA_SIZE; i += FIR_BLOCK_SIZE)
		arm_fir_f32(&S, pSrc + i, pDst + i, FIR_BLOCK_SIZE);
}
